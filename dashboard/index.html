<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HopVan - Bảng Điều Khiển</title>
    <meta property="og:title" content="HOPVAN - Nền Tảng Học & Luyện Thi Ngữ Văn" />
    <meta property="og:description" content="Nền tảng học tập Ngữ Văn tích hợp AI – hỗ trợ tự học thông minh, phân tích tác phẩm, luyện viết hiệu quả." />
    <meta property="og:image" content="https://hopvan.netlify.app/panel.webp" />
    <meta property="og:url" content="https://hopvan.netlify.app" />
    <meta property="og:type" content="article" />
    <link rel="icon" type="image/webp" href="../LOGO.WEBP" />

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #FF8F50;
            --primary-gradient: linear-gradient(135deg, #FF8F50, #FF5E62);
            --text-main: #2D3436;
            --text-light: #636E72;
            --glass-bg: rgba(255, 255, 255, 0.6);
            --glass-border: rgba(255, 255, 255, 0.8);
            --blur: 25px;
            --sidebar-width: 260px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease; }
        body { background-color: #FFF5EC; height: 100vh; overflow: hidden; display: flex; }

        /* --- BACKGROUND --- */
        .background-blobs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: floatBlob 10s infinite alternate; }
        .blob-1 { width: 500px; height: 500px; background: #FCA96A; top: -100px; left: -100px; }
        .blob-2 { width: 400px; height: 400px; background: #FCD5B5; bottom: -50px; right: -50px; animation-delay: -5s; }
        .blob-3 { width: 300px; height: 300px; background: #FFD1D1; top: 40%; left: 40%; animation-delay: -2s; }
        @keyframes floatBlob { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(30px, 50px) scale(1.1); } }

        /* --- MOBILE HEADER & OVERLAY --- */
        .mobile-header {
            display: none; position: fixed; top: 0; left: 0; right: 0;
            height: 60px; background: white; z-index: 100;
            align-items: center; padding: 0 20px; border-bottom: 1px solid #eee;
        }
        #sidebar-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
            z-index: 998;
        }

        .main-content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            height: 100%;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur));
            border-left: 1px solid var(--glass-border);
            padding: 30px 40px;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.02);
            -webkit-overflow-scrolling: touch;
        }

        .user-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .welcome-text h2 { font-size: 2.2rem; font-weight: 800; color: var(--text-main); }
        .user-avatar { width: 55px; height: 55px; background: var(--primary-gradient); border-radius: 18px; display: flex; justify-content: center; align-items: center; color: white; font-weight: 800; font-size: 1.3rem; box-shadow: 0 10px 25px rgba(255, 143, 80, 0.3); transform: rotate(-5deg); transition: 0.3s; cursor: pointer; }
        .user-avatar:hover { transform: rotate(0deg) scale(1.1); }

        .content-section { display: none; animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .content-section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr);
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card {
            background: white; padding: 25px; border-radius: 24px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.02); transition: 0.3s;
            border: 1px solid rgba(0,0,0,0.03); display: flex; flex-direction: column; justify-content: space-between;
        }
        .stat-card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 15px 35px rgba(255, 143, 80, 0.15); }

        .stat-card h3 { font-size: 0.95rem; color: var(--text-light); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;}
        .stat-card .value { font-size: 2.2rem; font-weight: 800; color: var(--text-main); line-height: 1; }
        .stat-card .unit { font-size: 0.9rem; color: var(--primary); font-weight: 700; margin-top: 5px; }

        .banner-cta {
            background: var(--primary-gradient); padding: 40px; border-radius: 30px; color: white;
            text-align: center; position: relative; overflow: hidden; margin-bottom: 30px;
            box-shadow: 0 15px 30px rgba(255, 94, 98, 0.25);
        }
        .banner-cta:hover .banner-decor { transform: rotate(-35deg) translate(15px, -25px) scale(1.1); opacity: 0.4; }
        .banner-decor { position: absolute; right: 20px; bottom: -20px; font-size: 8rem; opacity: 0.2; transform: rotate(-20deg); transition: all 0.5s ease; }

        .split-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 25px; margin-bottom: 30px; }
        .activity-box { background: white; padding: 25px; border-radius: 24px; border: 1px solid rgba(0,0,0,0.05); }
        .activity-item { display: flex; align-items: center; gap: 15px; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
        .activity-item:hover { transform: translateX(8px); background: #fafafa; border-radius: 12px; }

        .chart-box {
            background: white; border: 1px solid rgba(0,0,0,0.05);
            padding: 20px; border-radius: 24px; position: relative;
            display: flex; flex-direction: column; justify-content: space-between;
            cursor: pointer; transition: 0.3s;
        }
        .chart-box:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.05); border-color: var(--primary); }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .chart-title { font-weight: 800; color: var(--text-main); font-size: 1rem; }
        .chart-canvas-container { flex-grow: 1; position: relative; width: 100%; height: 180px; }

        .section-h3 { 
            font-size: 1.4rem; font-weight: 900; color: var(--text-main); 
            margin-top: 65px; margin-bottom: 25px; 
            display: flex; align-items: center; gap: 12px; padding-left: 20px; 
        }
        .tips-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 25px; padding: 0 20px; }
        .tip-card {
            background: white; padding: 22px; border-radius: 22px; display: flex; align-items: center; gap: 18px;
            cursor: pointer; border: 1px solid rgba(0,0,0,0.05); transition: 0.4s;
        }
        .tip-card:hover { transform: translateY(-5px) translateX(10px); border-color: var(--primary); box-shadow: 0 10px 25px rgba(255, 143, 80, 0.12); }
        .tip-img { width: 70px; height: 70px; border-radius: 15px; object-fit: cover; flex-shrink: 0; }
        .tip-content h4 { font-weight: 800; font-size: 1.05rem; margin-bottom: 6px; color: var(--text-main); }
        .tip-content p { font-size: 0.85rem; color: var(--text-light); line-height: 1.4; }

        /* --- HIỆU ỨNG POPUP CHUYÊN NGHIỆP (ĐÃ CẬP NHẬT) --- */
        .modal {
            display: none; /* Mặc định ẩn */
            position: fixed; inset: 0; 
            z-index: 9999999; 
            background-color: rgba(45, 52, 54, 0); /* Nền trong suốt ban đầu */
            backdrop-filter: blur(0px);
            justify-content: center; align-items: center;
            opacity: 0;
            transition: all 0.4s ease;
        }

        /* Class hiển thị khung (nhưng chưa hiện nội dung) */
        .modal.show-flex { display: flex !important; }

        /* Class kích hoạt hiệu ứng (nền tối + blur) */
        .modal.active {
            background-color: rgba(45, 52, 54, 0.3);
            backdrop-filter: blur(10px);
            opacity: 1;
        }

        .modal-content {
            background: white; padding: 40px; border-radius: 40px; 
            width: 95%; max-width: 800px; max-height: 85vh; 
            position: relative; 
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.1);
            display: flex; flex-direction: column; overflow: hidden;
            
            /* Trạng thái ban đầu: hơi nhỏ và nằm dưới */
            transform: translateY(40px) scale(0.95);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
        }

        /* Khi active: nội dung trồi lên và rõ dần */
        .modal.active .modal-content {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        
        .close-btn {
            position: absolute; top: 20px; right: 25px; border: none; background: #fff1eb; 
            width: 35px; height: 35px; border-radius: 50%; color: #FF8F50; cursor: pointer; transition: 0.3s; z-index: 10;
        }
        .close-btn:hover { transform: rotate(90deg); background: #FF8F50; color: #fff; }

        .modal-table-container { flex-grow: 1; overflow-y: auto; padding-right: 10px; margin-top: 10px; }
        .modal-stats-row { display: flex; gap: 20px; margin-bottom: 20px; }
        .modal-stat-box { flex: 1; background: #fafafa; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #eee; }

        /* --- MOBILE OPTIMIZATION --- */
        @media (max-width: 768px) { 
            body { height: 100%; overflow: auto; }
            .mobile-header { display: flex; z-index: 1000; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
            .main-content { 
                margin-left: 0 !important; width: 100% !important; 
                padding: 80px 20px 40px !important; height: auto !important; overflow: visible !important; 
            } 
            aside {
                position: fixed !important; left: 0 !important; top: 0 !important; bottom: 0 !important;
                transform: translateX(-100%); z-index: 9999 !important; width: 280px !important; 
                background: white !important; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }
            aside.open { transform: translateX(0) !important; box-shadow: 10px 0 50px rgba(0,0,0,0.2) !important; }
            #sidebar-overlay { z-index: 9998 !important; background: rgba(0,0,0,0.5) !important; backdrop-filter: blur(4px); }
            #sidebar-overlay.active { display: block !important; }

            .user-header { margin-bottom: 25px; }
            .welcome-text h2 { font-size: 1.5rem; }
            .user-avatar { width: 45px; height: 45px; font-size: 1.1rem; }

            .stats-grid { 
                display: flex !important; overflow-x: auto; scroll-snap-type: x mandatory; 
                gap: 15px; padding-bottom: 20px; margin: 0 -20px 20px -20px; padding-left: 20px; padding-right: 20px;
                scrollbar-width: none;
            }
            .stats-grid::-webkit-scrollbar { display: none; }
            .stat-card { min-width: 150px; width: 150px; scroll-snap-align: start; flex-shrink: 0; }

            .split-grid { display: flex !important; flex-direction: column; gap: 20px; }
            .banner-cta { padding: 25px 20px !important; align-items: center !important; text-align: center !important; min-height: auto !important; }
            .banner-cta h2 { font-size: 1.5rem !important; }
            .banner-decor { opacity: 0.1 !important; font-size: 6rem !important; bottom: -10px !important; }

            .chart-box { min-height: auto !important; height: auto !important; }
            #mini-leaderboard { max-height: 250px; }
            .tips-grid { grid-template-columns: 1fr !important; gap: 15px; }
            
            /* Modal Mobile Slide Up */
            .modal { align-items: flex-end; }
            .modal-content { 
                width: 100% !important; max-width: 100% !important; 
                border-radius: 20px 20px 0 0 !important; max-height: 90vh !important; 
                transform: translateY(100%); transition: transform 0.3s ease-out;
            }
            .modal.active .modal-content { transform: translateY(0); }
        }

        /* --- GLOBAL SCROLLBAR --- */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: rgba(255, 143, 80, 0.05); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background-color: rgba(255, 143, 80, 0.3); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; transition: background-color 0.3s ease; }
        ::-webkit-scrollbar-thumb:hover { background-color: #FF8F50; border: 1px solid transparent; }
        ::-webkit-scrollbar-button { display: none; }

        /* --- POPUP HOÀN TẤT HỒ SƠ --- */
        .profile-modal {
            display: none; position: fixed; inset: 0; background: rgba(255, 245, 236, 0.9); backdrop-filter: blur(15px);
            z-index: 100000; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease;
        }
        .profile-modal.show { display: flex; opacity: 1; }
        .pm-content {
            background: white; width: 90%; max-width: 420px; padding: 40px 30px; border-radius: 32px; text-align: center;
            box-shadow: 0 40px 80px rgba(255, 143, 80, 0.2), 0 0 0 1px rgba(255,255,255,1);
            transform: scale(0.9); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .profile-modal.show .pm-content { transform: scale(1); }
        .pm-icon {
            width: 80px; height: 80px; margin: 0 auto 20px; background: #ecfdf5; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: #FF8F50;
            box-shadow: 0 10px 20px rgba(255, 94, 98, 0.25); position: relative;
        }
        .pm-icon::after {
            content: "\f00c"; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; bottom: 0; right: 0;
            width: 28px; height: 28px; background: #FF8F50; color: white; border-radius: 50%; font-size: 0.9rem;
            border: 3px solid white; display: flex; align-items: center; justify-content: center;
        }
        .pm-title { font-size: 1.6rem; font-weight: 900; color: #2D3436; margin-bottom: 10px; letter-spacing: -0.5px; }
        .pm-desc { font-size: 0.95rem; color: #636E72; line-height: 1.6; margin-bottom: 30px; padding: 0 10px; }
        .pm-actions { display: grid; grid-template-columns: 1fr 1.5fr; gap: 12px; }
        .btn-pm-skip { padding: 14px; border-radius: 14px; font-weight: 700; cursor: pointer; background: #f1f5f9; color: #64748b; border: none; transition: 0.2s; }
        .btn-pm-skip:hover { background: #e2e8f0; }
        .btn-pm-update { padding: 14px; border-radius: 14px; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, #FF8F50, #FF5E62); color: white; border: none; box-shadow: 0 5px 15px rgba(255, 109, 111, 0.25); transition: 0.2s; }
        .btn-pm-update:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255, 109, 111, 0.25); }
    </style>
</head>
<body>

    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="mobile-header lg:hidden">
        <button onclick="toggleSidebar()" class="text-orange-500 text-2xl mr-4 focus:outline-none"><i class="fas fa-bars"></i></button>
        <div class="flex items-center gap-2"><img src="../LOGO.WEBP" alt="Logo" class="w-8 h-8"><span class="font-black text-orange-500 text-lg">HOPVAN</span></div>
    </div>
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div id="menu-placeholder"></div>

    <main class="main-content">
        <div class="user-header">
            <div class="welcome-text">
                <h2 id="welcome-name">Xin chào,</h2>
                <p style="color: var(--text-light); margin-top: 5px;">Hãy cùng bắt đầu học tập cùng với HopVan nhé!</p>
            </div>
            <div class="user-avatar" id="avatar-initial" onclick="window.location.href='account.html'" title="Đi đến trang cá nhân"></div>
        </div>

        <div id="overview" class="content-section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3><i class="fas fa-crown text-yellow-500"></i> Rank</h3>
                    <div class="value" id="rank-val" style="font-size: 1.5rem; color: #FF8F50;">Tân Binh</div>
                    <div class="unit" id="next-rank-info">0 ngày:</div>
                </div>
                <div class="stat-card">
                    <h3><i class="fas fa-fire" style="color: #FF5E62;"></i> Chuỗi</h3>
                    <div class="value" id="streak-value">0</div> <div class="unit">ngày liên tiếp</div>
                </div>
                <div class="stat-card">
                    <h3><i class="fas fa-key  text-yellow-500"></i> Keys</h3>
                    <div class="value" id="keys-value">0</div> <div class="unit">hiện có</div>
                </div>
                <div class="stat-card">
                    <h3><i class="fas fa-file-alt" style="color: #FF5E62;"></i> Đã làm</h3>
                    <div class="value" id="total-exams">0</div> <div class="unit">đề thi</div>
                </div>
            </div>
            
            <div class="split-grid" style="align-items: stretch;"> 
                <div class="banner-cta" style="margin-bottom: 0; padding: 30px 50px; display: flex; flex-direction: column; justify-content: center; align-items: flex-start; text-align: left; height: 100%;">
                    <div style="position: relative; z-index: 2; width: 100%;">
                        <div style="background: rgba(255,255,255,0.25); backdrop-filter: blur(5px); display: inline-flex; align-items: center; padding: 6px 16px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; margin-bottom: 18px; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
                            <i class="fas fa-magic mr-2 text-yellow-300"></i> AI Powered
                        </div>
                        <h2 style="font-size: 2rem; line-height: 1.2; margin-bottom: 12px; color: white; font-weight: 900; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">Sẵn sàng bứt phá?</h2>
                        <p style="opacity: 0.95; margin-bottom: 28px; font-size: 1rem; font-weight: 500; max-width: 85%; line-height: 1.6;">Hệ thống AI sẽ phân tích điểm mạnh, điểm yếu <br>và đề xuất lộ trình ôn thi riêng biệt cho bạn.</p>
                        <a href="phongluyende.html" class="hover:scale-105 hover:shadow-xl hover:bg-white/90 active:scale-95 transition-all duration-300 ease-out" style="background: white; color: #FF5E62; padding: 14px 32px; border: none; border-radius: 16px; font-weight: 800; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 8px 20px rgba(0,0,0,0.15);">Vào phòng luyện <i class="fas fa-arrow-right"></i></a>
                    </div>
                    <i class="fas fa-rocket banner-decor" style="font-size: 9rem; right: -20px; bottom: -40px; opacity: 0.15; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.1));"></i>
                </div>

                <div class="chart-box" style="padding: 20px; overflow: hidden; height: 100%; min-height: 320px;">
                    <div class="chart-header" style="margin-bottom: 15px;">
                        <h3 class="chart-title"><i class="fas fa-trophy text-yellow-500 mr-2"></i> BXH Keys</h3>
                        <button onclick="openLeaderboardModal()" class="text-xs font-bold text-orange-500 hover:underline">Xem tất cả</button>
                    </div>
                    <div id="mini-leaderboard" class="flex-grow flex flex-col gap-3 overflow-y-auto custom-scrollbar pr-1">
                        <div class="text-center text-gray-400 text-xs py-4">Đang tải...</div>
                    </div>
                    <div id="my-rank-footer" class="mt-auto pt-3 border-t border-dashed border-gray-200 flex justify-between items-center text-xs font-bold text-gray-600">
                        <span>Hạng của bạn:</span> <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-lg">--</span>
                    </div>
                </div>
            </div>

            <div class="split-grid">
                <div class="activity-box">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="font-weight: 800; display: flex; align-items: center; color: var(--text-main); margin-bottom: 0;"><i class="fas fa-history" style="margin-right: 10px; color: var(--primary);"></i> Hoạt động gần đây</h3>
                        <button onclick="openActivityModal()" style="background: none; border: none; color: #FF8F50; font-weight: 700; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 5px;">Xem tất cả <i class="fas fa-chevron-right" style="font-size: 0.7rem;"></i></button>
                    </div>
                    <ul class="activity-list" id="activity-list">
                        <li style="text-align: center; color: #999; padding: 20px;">Đang tải dữ liệu...</li>
                    </ul>
                </div>

                <div class="chart-box" onclick="openStatsModal()">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-chart-pie text-orange-500 mr-2"></i> Thống kê Kết quả Học tập</h3>
                        <i class="fas fa-expand-alt text-gray-400"></i>
                    </div>
                    <div class="chart-canvas-container">
                        <canvas id="miniChart"></canvas>
                    </div>
                </div>
            </div>

            <h3 class="section-h3"><i class="fas fa-lightbulb" style="color: #FF8F50;"></i> Bí kíp điểm cao</h3>
            <div class="tips-grid">
                <div class="tip-card" onclick="window.location.href='bantinvanhoc.html'">
                    <img src="https://img.freepik.com/free-vector/creative-writing-concept-illustration_114360-8139.jpg" class="tip-img" alt="Tip">
                    <div class="tip-content"><h4>Cách viết mở bài hiệu quả</h4><p>3 công thức mở bài áp dụng cho mọi tác phẩm văn học hiện đại.</p></div>
                </div>
                <div class="tip-card" onclick="window.location.href='bantinvanhoc.html'">
                    <img src="https://img.freepik.com/free-vector/writer-concept-illustration_114360-1490.jpg" class="tip-img" alt="Tip">
                    <div class="tip-content"><h4>Dẫn chứng NLXH "đắt giá"</h4><p>Tổng hợp những dẫn chứng thực tế mới nhất năm 2026.</p></div>
                </div>
            </div>
        </div>
    </main>

    <div id="activityFullModal" class="modal">
        <div class="modal-content">
            <button onclick="closeActivityModal()" class="close-btn"><i class="fas fa-times"></i></button>
            <div style="text-align: left; margin-bottom: 25px;">
                <h2 style="font-size: 2.2rem; font-weight: 900; color: var(--text-main); letter-spacing: -1px;">Nhật ký nỗ lực</h2>
                <p style="color: var(--text-light); font-size: 0.9rem;">Bạn đã hoàn thành <span id="modal-count-val" style="color: var(--primary); font-weight: 800;">0</span> hoạt động</p>
            </div>
            <div class="modal-table-container">
                <table style="width: 100%; border-collapse: separate; border-spacing: 0 10px;">
                    <thead><tr style="text-align: left; color: #bbb; font-size: 0.75rem; text-transform: uppercase;"><th style="padding: 0 10px 15px;">Nội dung</th><th>Thời gian</th><th style="text-align: right; padding-right: 15px;">Điểm số</th></tr></thead>
                    <tbody id="full-activity-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="leaderboardModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <button onclick="closeLeaderboardModal()" class="close-btn"><i class="fas fa-times"></i></button>
            <div style="text-align: center; margin-bottom: 25px;">
                <h2 style="font-size: 1.8rem; font-weight: 900; color: var(--text-main);">Bảng Xếp Hạng Keys</h2>
                <p style="color: var(--text-light); font-size: 0.9rem;">Đua Top Keys - Nhận quà khủng</p>
            </div>
            <div class="modal-table-container custom-scrollbar" style="max-height: 400px;">
                <table style="width: 100%; border-collapse: separate; border-spacing: 0 8px;">
                    <thead class="sticky top-0 bg-white z-10"><tr style="text-align: left; color: #999; font-size: 0.7rem; text-transform: uppercase;"><th class="pb-2 pl-2">Hạng</th><th class="pb-2">Tài khoản</th><th class="pb-2 text-right pr-2">Keys</th></tr></thead>
                    <tbody id="full-leaderboard-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="statsFullModal" class="modal">
        <div class="modal-content">
            <button onclick="closeStatsModal()" class="close-btn"><i class="fas fa-times"></i></button>
            <div style="text-align: left; margin-bottom: 20px;">
                <h2 style="font-size: 2rem; font-weight: 900; color: var(--text-main);">Thống kê Kết quả Học tập</h2>
                <p style="color: var(--text-light);">Tổng quan năng lực hiện tại của bạn.</p>
            </div>
            <div class="modal-stats-row">
                <div class="modal-stat-box"><div class="ms-val" id="avg-quiz-score">0.0</div><div class="ms-label">TB Trắc nghiệm</div></div>
                <div class="modal-stat-box"><div class="ms-val" id="avg-essay-score">0.0</div><div class="ms-label">TB Tự luận</div></div>
                <div class="modal-stat-box"><div class="ms-val" id="total-tests-count">0</div><div class="ms-label">Tổng số bài</div></div>
            </div>
            <div style="flex-grow: 1; position: relative; min-height: 300px;"><canvas id="largeChart"></canvas></div>
        </div>
    </div>

    <div id="profileUpdateModal" class="profile-modal">
        <div class="pm-content">
            <div class="pm-icon"><i class="far fa-user"></i></div>
            <h3 class="pm-title">Hoàn tất hồ sơ</h3>
            <p class="pm-desc">Vui lòng cập nhật thông tin <b>Trường học</b> và <b>Khối lớp</b> để HopVan tối ưu lộ trình học tập tốt nhất cho bạn.</p>
            <div class="pm-actions">
                <button onclick="closeProfileModal()" class="btn-pm-skip">Để sau</button>
                <button onclick="window.location.href='account.html'" class="btn-pm-update">Cập nhật ngay</button>
            </div>
        </div>
    </div>

    <script type="module" src="gam.js"></script>
    <script src="../chatbot.js"></script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, where, orderBy, onSnapshot, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { initMenu } from "./menu.js";

    const firebaseConfig = { apiKey: "AIzaSyAJ9C2biYeiLPmhakzLZ4mEqfO9_VgPSZE", authDomain: "hopvan-9a648.firebaseapp.com", projectId: "hopvan-9a648", storageBucket: "hopvan-9a648.appspot.com", messagingSenderId: "429347196227", appId: "1:429347196227:web:917b8d019f0efd0f7833f6", measurementId: "G-1BG8PSRG0R" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let allActivities = [];
    let miniChartInstance = null;
    let largeChartInstance = null;

    const EXAM_TYPES = {
        'nlxh': { name: 'Nghị Luận Xã Hội', icon: 'fas fa-users', color: '#10b981' }, 
        'nlvh': { name: 'Nghị Luận Văn Học', icon: 'fas fa-book-open', color: '#8b5cf6' }, 
        'reading': { name: 'Đọc Hiểu', icon: 'fas fa-glasses', color: '#3b82f6' }, 
        'fulltest': { name: 'Đề Tổng Hợp', icon: 'fas fa-layer-group', color: '#f59e0b' }, 
        'random': { name: 'Luyện Ngẫu Nhiên', icon: 'fas fa-dice', color: '#ef4444' } 
    };

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            // Tạm thời hiển thị tên
            const name = user.displayName || user.email.split('@')[0];
            document.getElementById('welcome-name').textContent = `Xin chào, ${name}`;
            
            // Chuyển toàn bộ logic xử lý Avatar xuống hàm updateUserStreak để lấy dữ liệu từ Database
            updateUserStreak(user);
            setupRealtimeStats(user);
            setupLeaderboard(user);
        } else { window.location.href = "../log.html"; }
    });

    // --- HÀM XỬ LÝ DỮ LIỆU & HIỂN THỊ ---

    function setupRealtimeStats(user) {
        // Lấy toàn bộ hoạt động để tính toán
        const q = query(collection(db, "activities"), where("uid", "==", user.uid), orderBy("timestamp", "desc"));
        
        onSnapshot(q, (snapshot) => {
            allActivities = snapshot.docs.map(doc => doc.data());
            
            // 1. Cập nhật số tổng đề thi
            document.getElementById('total-exams').textContent = allActivities.length;
            
            // 2. Cập nhật List nhỏ (Hoạt động gần đây - chỉ lấy 3 cái mới nhất)
            updateMiniActivityList(allActivities.slice(0, 3));
            
            // 3. Vẽ biểu đồ nhỏ (Mini Chart)
            drawMiniChart(allActivities);
        });
    }

    // Hàm render danh sách nhỏ ngoài Dashboard
    function updateMiniActivityList(dataList) {
        const listEl = document.getElementById('activity-list');
        if (!listEl) return;

        if (dataList.length === 0) {
            listEl.innerHTML = `<li style="text-align: center; color: #999; padding: 20px; font-weight: 700;">Chưa có hoạt động nào.</li>`;
        } else {
            listEl.innerHTML = dataList.map(data => {
                const typeInfo = EXAM_TYPES[data.type] || { name: 'Bài Tập', icon: 'fas fa-pen', color: '#999' };
                const score = typeof data.score === 'number' ? data.score : parseFloat(data.score || 0);
                const scoreDisplay = score > 0 ? `<span style="color:${typeInfo.color}; font-weight:800;">${score.toFixed(2)}đ</span>` : '<span style="color:#999">--</span>';
                const d = data.timestamp ? data.timestamp.toDate() : new Date();
                
                return `
                <li class="activity-item">
                    <div style="background: ${typeInfo.color}20; color: ${typeInfo.color}; border-radius: 10px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; flex-shrink:0;">
                        <i class="${typeInfo.icon}"></i>
                    </div>
                    <div style="flex-grow: 1; overflow: hidden;">
                        <h4 style="font-weight: 800; font-size: 0.9rem; color: #2d3436; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${typeInfo.name}</h4>
                        <p style="font-size: 0.75rem; color:#999;">${d.toLocaleDateString('vi-VN')}</p>
                    </div>
                    <div style="text-align:right; font-weight:bold;">${scoreDisplay}</div>
                </li>`;
            }).join('');
        }
    }

    // Hàm xử lý dữ liệu biểu đồ
    function processChartData(activities) {
        // Lấy các bài có điểm
        const scoredActs = activities.filter(a => a.score !== undefined && a.score !== null);
        // Lấy 10 bài gần nhất, đảo ngược để cũ -> mới (biểu đồ đi từ trái sang phải)
        const last10 = scoredActs.slice(0, 10).reverse();
        
        const labels = last10.map(a => { 
            const d = a.timestamp ? a.timestamp.toDate() : new Date(); 
            return `${d.getDate()}/${d.getMonth()+1}`; 
        });
        const data = last10.map(a => parseFloat(a.score));

        // Tính điểm trung bình cho Popup Thống kê
        let quizSum = 0, quizCount = 0; 
        let essaySum = 0, essayCount = 0;
        activities.forEach(a => {
            const s = parseFloat(a.score || 0);
            if (a.type === 'quiz' || a.type === 'reading') { quizSum += s; quizCount++; }
            else if (a.type === 'nlxh' || a.type === 'nlvh' || a.type === 'fulltest') { essaySum += s; essayCount++; }
        });

        return { 
            labels, data, 
            avgQuiz: quizCount ? (quizSum / quizCount).toFixed(1) : "0.0", 
            avgEssay: essayCount ? (essaySum / essayCount).toFixed(1) : "0.0", 
            total: activities.length 
        };
    }

    // Hàm vẽ biểu đồ nhỏ ngoài Dashboard
    function drawMiniChart(activities) {
        const chartData = processChartData(activities);
        const canvas = document.getElementById('miniChart');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        if (miniChartInstance) miniChartInstance.destroy();
        
        miniChartInstance = new Chart(ctx, { 
            type: 'line', 
            data: { 
                labels: chartData.labels, 
                datasets: [{ 
                    label: 'Điểm', 
                    data: chartData.data, 
                    borderColor: '#FF8F50', 
                    backgroundColor: (context) => {
                        const ctx = context.chart.ctx;
                        const gradient = ctx.createLinearGradient(0, 0, 0, 180);
                        gradient.addColorStop(0, 'rgba(255, 143, 80, 0.4)');
                        gradient.addColorStop(1, 'rgba(255, 143, 80, 0.0)');
                        return gradient;
                    },
                    borderWidth: 2,
                    tension: 0.4, 
                    fill: true, 
                    pointRadius: 3,
                    pointBackgroundColor: '#fff', 
                    pointBorderColor: '#FF8F50'
                }] 
            }, 
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                plugins: { legend: { display: false }, tooltip: { enabled: true } }, 
                scales: { 
                    y: { beginAtZero: true, max: 10, ticks: { display: false }, grid: { display: false } }, 
                    x: { display: false } 
                },
                layout: { padding: 5 }
            } 
        });
    }

    // --- POPUP LOGIC (GIỮ NGUYÊN HIỆU ỨNG MƯỢT) ---

    window.openActivityModal = () => {
        const bodyEl = document.getElementById('full-activity-body');
        document.getElementById('modal-count-val').textContent = allActivities.length;
        
        // Render danh sách FULL trong Popup
        bodyEl.innerHTML = allActivities.map(data => {
            const typeInfo = EXAM_TYPES[data.type] || { name: 'Bài Tập', color: '#999' };
            const d = data.timestamp ? data.timestamp.toDate() : new Date();
            const score = typeof data.score === 'number' ? data.score : parseFloat(data.score || 0);
            return `<tr style="background: #fafafa; border-radius: 15px;"><td style="padding: 15px 10px; font-weight: 800; border-radius: 15px 0 0 15px; color: ${typeInfo.color}">${typeInfo.name}</td><td style="font-weight: 600; color: #636e72; font-size: 0.85rem;">${d.toLocaleDateString('vi-VN')} ${d.toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'})}</td><td style="text-align: right; padding-right: 15px; border-radius: 0 15px 15px 0; font-weight: 900; color: var(--text-main);">${score.toFixed(2)}</td></tr>`;
        }).join('');
        
        window.openHVModal('activityFullModal');
    };

    window.openStatsModal = () => {
        const stats = processChartData(allActivities);
        const quizValEl = document.getElementById('avg-quiz-score');
        if(quizValEl) { quizValEl.textContent = stats.avgQuiz; quizValEl.nextElementSibling.textContent = "TB Trắc nghiệm"; }
        const essayValEl = document.getElementById('avg-essay-score');
        if(essayValEl) { essayValEl.textContent = stats.avgEssay; essayValEl.nextElementSibling.textContent = "TB Tự luận"; }
        const totalEl = document.getElementById('total-tests-count');
        if(totalEl) totalEl.textContent = stats.total;
        
        window.openHVModal('statsFullModal');

        // Vẽ biểu đồ LỚN trong Popup
        setTimeout(() => {
            const ctx = document.getElementById('largeChart').getContext('2d');
            if (largeChartInstance) largeChartInstance.destroy();
            largeChartInstance = new Chart(ctx, { 
                type: 'line', 
                data: { 
                    labels: stats.labels, 
                    datasets: [{ label: 'Tiến độ điểm số', data: stats.data, borderColor: '#FF5E62', backgroundColor: 'rgba(255, 94, 98, 0.1)', borderWidth: 3, tension: 0.3, fill: true, pointBackgroundColor: '#fff', pointBorderColor: '#FF5E62', pointRadius: 6 }] 
                }, 
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, max: 10 } } } 
            });
        }, 400);
    };

    // --- CÁC HÀM KHÁC (USER, LEADERBOARD...) GIỮ NGUYÊN ---
    
    async function updateUserStreak(user) {
        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);
        const todayStr = new Date().toLocaleDateString('en-CA');
        const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toLocaleDateString('en-CA');
        
        let currentStreak = 1;
        let userData = {};

        if (userSnap.exists()) {
            userData = userSnap.data();
            
            if (!userData.school || !userData.grade) {
                const hasSkipped = sessionStorage.getItem('skipped_profile_update');
                if (!hasSkipped) setTimeout(() => { document.getElementById('profileUpdateModal').classList.add('show'); }, 1500);
            }

            // ĐỒNG BỘ ẢNH GOOGLE VÀO FIRESTORE ĐỂ BXH THẤY ĐƯỢC
            if (user.photoURL && userData.photoURL !== user.photoURL) {
                await updateDoc(userRef, { photoURL: user.photoURL });
                userData.photoURL = user.photoURL; // Cập nhật local
            }

            document.getElementById('keys-value').textContent = userData.keys || 0;
            currentStreak = userData.streak || 1;
            
            if (userData.lastLoginDate !== todayStr) {
                currentStreak = (userData.lastLoginDate === yesterdayStr) ? currentStreak + 1 : 1;
                await updateDoc(userRef, { lastLoginDate: todayStr, streak: currentStreak });
            }
            document.getElementById('streak-value').textContent = currentStreak;
            updateRankDisplay(currentStreak);

        } else {
            // User mới
            userData = { lastLoginDate: todayStr, streak: 1, email: user.email, keys: 0, photoURL: user.photoURL || null };
            await setDoc(userRef, userData);
            document.getElementById('streak-value').textContent = 1;
            document.getElementById('keys-value').textContent = 0; 
            updateRankDisplay(1);
        }

        // --- XỬ LÝ AVATAR TRÊN HEADER CHUẨN XÁC ---
        const avatarEl = document.getElementById('avatar-initial');
        const displayName = userData.name || user.displayName || user.email.split('@')[0];

        if (userData.customAvatar) {
            // 1. Nếu có ảnh tự đổi
            avatarEl.innerHTML = `<img src="${userData.customAvatar}" alt="User" style="width: 100%; height: 100%; object-fit: cover; border-radius: inherit;">`;
            avatarEl.style.background = 'transparent';
        } else if (userData.photoURL || user.photoURL) {
            // 2. Nếu có ảnh Google
            avatarEl.innerHTML = `<img src="${userData.photoURL || user.photoURL}" alt="User" style="width: 100%; height: 100%; object-fit: cover; border-radius: inherit;">`;
            avatarEl.style.background = 'transparent';
        } else {
            // 3. Không có gì thì dùng chữ cái
            avatarEl.innerHTML = "";
            avatarEl.textContent = displayName.charAt(0).toUpperCase();
            avatarEl.style.background = 'linear-gradient(135deg, #FF8F50, #FF5E62)';
        }
    }

    function updateRankDisplay(streak) {
        let r = "Tân Binh";
        let next = "3 ngày: Chớm lửa";
        if (streak >= 3) { r = "Chớm Lửa"; next = "7 ngày: Giữ lửa"; }
        if (streak >= 7) { r = "Giữ Lửa"; next = "30 ngày: Bền lửa"; }
        if (streak >= 30) { r = "Bền Lửa"; next = "100 ngày: Người ở lại"; }
        if (streak >= 100) { r = "Người Ở Lại"; next = "Huyền thoại!"; }
        document.getElementById('rank-val').innerText = r;
        document.getElementById('next-rank-info').innerText = next;
    }

    // --- LEADERBOARD ---
    function setupLeaderboard(currentUser) {
        const usersRef = collection(db, "users");
        onSnapshot(usersRef, (snapshot) => {
            let users = [];
            snapshot.forEach(doc => {
                const d = doc.data();
                if (d.email) users.push({ id: doc.id, ...d, keys: d.keys || 0 });
            });
            users.sort((a, b) => b.keys - a.keys);
            window.fullLeaderboardData = users;
            window.currentUserId = currentUser.uid;
            renderMiniLeaderboard(users, currentUser.uid);
        });
    }

    function renderMiniLeaderboard(users, myUid) {
        const container = document.getElementById('mini-leaderboard');
        const myRankEl = document.getElementById('my-rank-footer');
        const topUsers = users.slice(0, 4); 
        
        container.innerHTML = topUsers.map((u, index) => {
            let rankBadge = `<span class="w-6 h-6 flex items-center justify-center rounded-full font-bold text-xs bg-gray-100 text-gray-500">${index + 1}</span>`;
            if (index === 0) rankBadge = `<i class="fas fa-crown text-yellow-400 text-lg"></i>`;
            if (index === 1) rankBadge = `<i class="fas fa-medal text-gray-400 text-lg"></i>`;
            if (index === 2) rankBadge = `<i class="fas fa-medal text-orange-700 text-lg"></i>`;

            const isMe = u.id === myUid ? "bg-orange-50 border-orange-100" : "bg-gray-50 border-transparent";
            const name = u.email ? u.email.split('@')[0] : "Ẩn danh";
            
            // Xử lý Avatar cho bảng nhỏ
            let avatarContent = name.charAt(0).toUpperCase();
            if (u.customAvatar) {
                avatarContent = `<img src="${u.customAvatar}" class="w-full h-full object-cover rounded-full">`;
            } else if (u.photoURL) {
                avatarContent = `<img src="${u.photoURL}" class="w-full h-full object-cover rounded-full">`;
            }

            return `
            <div class="flex items-center justify-between p-2 rounded-xl border ${isMe}">
                <div class="flex items-center gap-3">
                    <div class="w-6 text-center">${rankBadge}</div>
                    <div class="flex items-center gap-2">
                        <div class="w-7 h-7 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center text-[10px] font-bold overflow-hidden shadow-sm">
                            ${avatarContent}
                        </div>
                        <span class="font-bold text-gray-700 text-sm truncate max-w-[80px]">${name}</span>
                    </div>
                </div>
                <div class="font-black text-orange-500 text-sm flex items-center gap-1">
                    ${u.keys || 0} <i class="fas fa-key text-[10px] text-gray-300"></i>
                </div>
            </div>`;
        }).join('');

        const myIndex = users.findIndex(u => u.id === myUid);
        const myRank = myIndex !== -1 ? myIndex + 1 : "--";
        const myKeys = myIndex !== -1 ? (users[myIndex].keys || 0) : 0;
        
        myRankEl.innerHTML = `
            <span class="text-gray-500">Hạng của bạn:</span>
            <div class="flex items-center gap-2">
                <span class="font-black text-gray-800">#${myRank}</span>
                <span class="bg-orange-100 text-orange-600 px-2 py-0.5 rounded text-[10px] font-bold">${myKeys} keys</span>
            </div>
        `;
    }

    // Mở Bảng Xếp Hạng (Đã Style Top 1,2,3,4 đặc biệt)
    window.openLeaderboardModal = () => {
        const users = window.fullLeaderboardData || [];
        const myUid = window.currentUserId;
        const tbody = document.getElementById('full-leaderboard-body');
        
        if (tbody) {
            tbody.innerHTML = users.map((u, index) => {
                const rank = index + 1;
                const name = u.email ? u.email.split('@')[0] : "User";
                const isMe = u.id === myUid;
                
                // --- XỬ LÝ RANK (GIỮ NGUYÊN) ---
                let rankHtml = '';
                if (rank === 1) {
                    rankHtml = `<div class="w-10 h-10 mx-auto bg-orange-50 rounded-lg flex items-center justify-center shadow-sm"><span class="font-black text-2xl text-yellow-500">#1</span></div>`;
                } else if (rank === 2) {
                    rankHtml = `<span class="font-black text-2xl text-slate-400">#2</span>`;
                } else if (rank === 3) {
                    rankHtml = `<span class="font-black text-2xl text-gray-500">#3</span>`;
                } else if (rank === 4) {
                    rankHtml = `<span class="font-black text-xl text-gray-600">#4</span>`;
                } else {
                    rankHtml = `<span class="font-bold text-gray-400 text-sm">#${rank}</span>`;
                }

                // --- XỬ LÝ AVATAR (MỚI THÊM) ---
                let avatarContent;
                if (u.customAvatar) {
                    // Ưu tiên 1: Ảnh tự upload (Base64)
                    avatarContent = `<img src="${u.customAvatar}" class="w-full h-full object-cover rounded-full" alt="${name}">`;
                } else if (u.photoURL) {
                    // Ưu tiên 2: Ảnh Google
                    avatarContent = `<img src="${u.photoURL}" class="w-full h-full object-cover rounded-full" alt="${name}">`;
                } else {
                    // Mặc định: Chữ cái đầu
                    avatarContent = name.charAt(0).toUpperCase();
                }

                const rowClass = isMe ? 'bg-orange-50 border border-orange-200 shadow-sm relative z-10 transform scale-[1.01]' : 'border-b border-gray-50 hover:bg-gray-50';

                return `
                <tr class="${rowClass} transition-all duration-200">
                    <td class="py-3 text-center w-20 align-middle">
                        ${rankHtml}
                    </td>
                    <td class="py-3 pl-2 align-middle">
                        <div class="flex items-center gap-3">
                            <div class="w-9 h-9 rounded-full bg-white border border-gray-100 flex items-center justify-center text-xs font-bold text-gray-500 shadow-sm overflow-hidden">
                                ${avatarContent}
                            </div>
                            <div class="flex flex-col">
                                <span class="font-bold text-gray-700 text-sm">${name}</span>
                                ${isMe ? '<span class="text-[10px] text-orange-500 font-extrabold uppercase tracking-wider">Bạn</span>' : ''}
                            </div>
                        </div>
                    </td>
                    <td class="pr-6 py-3 text-right align-middle">
                        <span class="font-black text-gray-800 text-base">${u.keys || 0}</span>
                        <i class="fas fa-key text-yellow-400 text-xs ml-1"></i>
                    </td>
                </tr>`;
            }).join('');
        }
        window.openHVModal('leaderboardModal');
    };

    // --- MODAL UTILS ---
    window.openHVModal = function(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        modal.classList.add('show-flex'); 
        setTimeout(() => { modal.classList.add('active'); }, 10);
    };

    window.closeHVModal = function(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        modal.classList.remove('active'); 
        setTimeout(() => { modal.classList.remove('show-flex'); }, 400); 
    };

    window.closeActivityModal = () => window.closeHVModal('activityFullModal');
    window.closeStatsModal = () => window.closeHVModal('statsFullModal');
    window.closeLeaderboardModal = () => window.closeHVModal('leaderboardModal');
    window.closeProfileModal = () => {
        const modal = document.getElementById('profileUpdateModal');
        modal.classList.remove('show');
        setTimeout(() => modal.style.display = 'none', 300);
        sessionStorage.setItem('skipped_profile_update', 'true');
    };
    window.toggleSidebar = () => {
        const sidebar = document.querySelector('aside') || document.getElementById('main-sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (sidebar && overlay) {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : 'auto';
        }
    };

    initMenu(app);
</script>
</body>
</html>