<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HopVan - Bản Tin Văn Học</title>
    <meta property="og:title" content="HOPVAN - Nền Tảng Học & Luyện Thi Ngữ Văn" />
    <meta property="og:description" content="Nền tảng học tập Ngữ Văn tích hợp AI – hỗ trợ tự học thông minh, phân tích tác phẩm, luyện viết hiệu quả." />
    <meta property="og:image" content="https://hopvan.netlify.app/panel.webp" />
    <meta property="og:url" content="https://hopvan.netlify.app" />
    <meta property="og:type" content="article" />
    <link rel="icon" type="image/webp" href="../LOGO.WEBP" />
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --primary: #FF8F50;
            --primary-gradient: linear-gradient(135deg, #FF8F50, #FF5E62);
            --text-heading: #2D3436;
            --bg-body: #FFF5EC;
            --sidebar-width: 280px;
        }

        /* --- BASE --- */
        body { background-color: var(--bg-body); font-family: 'Plus Jakarta Sans', sans-serif; color: #444; overflow-x: hidden; }

        /* --- LAYOUT FIX --- */
        #menu-placeholder { position: fixed; top: 0; left: 0; height: 100vh; z-index: 900; }
        
        .main-content {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            min-height: 100vh;
            padding: 40px 60px;
            background: rgba(255, 255, 255, 0.4); 
            backdrop-filter: blur(20px);
        }

        /* --- TEXT STYLE --- */
        .text-gradient { 
            background: var(--primary-gradient); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            font-weight: 800;
        }
        
        .page-header { text-align: center; margin-bottom: 30px; padding-top: 20px; }
        .page-title { font-size: 3rem; font-weight: 800; color: var(--text-heading); letter-spacing: -1px; margin-bottom: 5px; }
        .page-subtitle { font-size: 1rem; color: #888; font-weight: 600; }
        
        /* Search Box */
        .search-box-wrap { position: relative; max-width: 500px; margin: 25px auto 0; }
        .search-inp { 
            width: 100%; padding: 14px 25px 14px 55px; 
            border-radius: 20px; border: 2px solid white; 
            background: white; box-shadow: 0 10px 30px rgba(255,143,80,0.1); 
            font-weight: 600; outline: none; transition: 0.3s; 
        }
        .search-inp:focus { border-color: var(--primary); box-shadow: 0 15px 40px rgba(255,143,80,0.2); }
        .search-icon { position: absolute; left: 22px; top: 50%; transform: translateY(-50%); color: #FF8F50; font-size: 1.1rem; }

        /* --- MENU LOC (SCROLL) --- */
        .nav-wrapper { 
            display: flex; justify-content: center; margin-bottom: 40px; 
            position: relative; padding: 0 40px;
        }
        .nav-container {
            display: flex; gap: 10px; overflow-x: auto; padding: 5px; 
            scrollbar-width: none; -webkit-overflow-scrolling: touch;
            max-width: 1000px;
        }
        .nav-container::-webkit-scrollbar { display: none; }
        
        .nav-btn {
            white-space: nowrap; padding: 10px 24px; border-radius: 50px; 
            font-weight: 700; font-size: 0.9rem; color: #666; 
            background: white; border: 1px solid rgba(0,0,0,0.05); 
            cursor: pointer; transition: 0.3s; flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.02);
        }
        .nav-btn:hover { color: var(--primary); transform: translateY(-2px); }
        .nav-btn.active { 
            background: var(--primary-gradient); color: white; 
            border-color: transparent; box-shadow: 0 8px 20px rgba(255, 94, 98, 0.4); 
            transform: translateY(-2px);
        }

        .nav-arrow {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 40px; height: 40px; border-radius: 50%; background: white;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); color: var(--primary);
            cursor: pointer; z-index: 10; transition: 0.2s;
        }
        .nav-arrow:hover { transform: translateY(-50%) scale(1.1); background: var(--primary); color: white; }
        .nav-prev { left: 0; }
        .nav-next { right: 0; }

        /* --- CARD GIAO DIỆN MỚI --- */
        .news-grid { 
            display: grid; 
            grid-template-columns: repeat(1, 1fr); 
            gap: 30px; 
        }
        @media (min-width: 768px) { .news-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1100px) { .news-grid { grid-template-columns: repeat(3, 1fr); } }

        .card { 
            background: white; border-radius: 24px; overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.03); 
            border: 1px solid rgba(255,255,255,0.8);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            cursor: pointer; display: flex; flex-direction: column;
            position: relative; height: 100%;
        }
        .card:hover { transform: translateY(-10px); box-shadow: 0 20px 50px rgba(255, 143, 80, 0.2); border-color: var(--primary); }
        
        .c-img-box { height: 200px; overflow: hidden; position: relative; }
        .c-img { width: 100%; height: 100%; object-fit: cover; transition: 0.6s; }
        .card:hover .c-img { transform: scale(1.1); }
        
        .c-badge { 
            position: absolute; top: 15px; left: 15px; 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(5px);
            padding: 6px 14px; border-radius: 12px; 
            font-size: 0.7rem; font-weight: 800; text-transform: uppercase; 
            color: var(--text-heading); box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .c-body { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
        .c-title { 
            font-size: 1.2rem; font-weight: 800; line-height: 1.4; 
            color: var(--text-heading); margin-bottom: 12px; 
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            transition: 0.3s;
        }
        .card:hover .c-title { color: #FF8F50; }
        
        .c-desc { 
            font-size: 0.9rem; color: #666; line-height: 1.6; margin-bottom: 20px; flex-grow: 1;
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
            font-family: 'Merriweather', serif; 
        }

        .c-footer {
            border-top: 1px solid #f0f0f0; padding-top: 15px; margin-top: auto;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.8rem; color: #aaa; font-weight: 600;
        }
        .read-link { color: var(--primary); display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .card:hover .read-link { gap: 10px; }

        /* FEATURED CARD */
        .featured-card {
            grid-column: 1 / -1; /* Chiếm full chiều ngang */
            display: grid; grid-template-columns: 1.5fr 1fr; gap: 0;
            background: white; border-radius: 30px; overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.05); margin-bottom: 20px;
            cursor: pointer; height: 380px; transition: 0.4s;
            border: 2px solid white;
        }
        .featured-card:hover { transform: translateY(-5px); box-shadow: 0 25px 60px rgba(255, 143, 80, 0.2); }
        .featured-card .c-img-box { height: 100%; }
        .featured-card .c-body { padding: 40px; justify-content: center; }
        .featured-card .c-title { font-size: 2.2rem; }
        
        /* LOADING */
        .loading-state { text-align: center; padding: 100px 0; color: #ccc; font-weight: 600; }

        /* --- MOBILE --- */
        .mobile-header { display: none; }
        @media (max-width: 1023px) {
            .mobile-header { display: flex; position: fixed; top: 0; left: 0; right: 0; height: 70px; background: rgba(255,255,255,0.95); z-index: 1000; align-items: center; padding: 0 20px; }
            #menu-placeholder { width: 0; }
            aside { position: fixed; left: -280px; top: 0; bottom: 0; width: 280px; transition: 0.3s; z-index: 1001; }
            aside.open { left: 0; }
            #sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 999; }
            #sidebar-overlay.active { display: block; }
            
            .main-content { margin-left: 0; width: 100%; padding: 100px 20px 40px; }
            .nav-wrapper { padding: 0; } .nav-arrow { display: none; }
            .nav-container { padding: 0 10px; }
            
            .featured-card { grid-template-columns: 1fr; height: auto; }
            .featured-card .c-img-box { height: 200px; }
            .featured-card .c-body { padding: 25px; }
            .featured-card .c-title { font-size: 1.5rem; }
        }
        
        /* Background Blobs */
        .background-blobs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; pointer-events: none; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; animation: floatBlob 10s infinite alternate; }
        .blob-1 { width: 500px; height: 500px; background: #FCA96A; top: -100px; left: -100px; }
        .blob-2 { width: 400px; height: 400px; background: #FCD5B5; bottom: -50px; right: -50px; animation-delay: -5s; }
        .blob-3 { width: 300px; height: 300px; background: #FFD1D1; top: 40%; left: 40%; animation-delay: -2s; }

/* --- GLOBAL SCROLLBAR STYLE --- */

/* 1. Thiết lập độ rộng/cao của thanh trượt */
::-webkit-scrollbar {
    width: 10px;  /* Độ rộng cho thanh dọc */
    height: 10px; /* Độ cao cho thanh ngang */
}

/* 2. Thiết lập rãnh trượt (Track) - Nền chìm */
::-webkit-scrollbar-track {
    background: rgba(255, 143, 80, 0.05); /* Màu cam cực nhạt, gần như trong suốt */
    border-radius: 10px;
}

/* 3. Thiết lập tay nắm (Thumb) - Phần di chuyển */
::-webkit-scrollbar-thumb {
    background-color: rgba(255, 143, 80, 0.3); /* Mặc định là cam nhạt */
    border-radius: 10px; /* Bo tròn mềm mại */
    
    /* Mẹo: Tạo viền trong suốt để thanh trượt trông nhỏ hơn và "lơ lửng" */
    border: 2px solid transparent;
    background-clip: content-box;
    transition: background-color 0.3s ease;
}

/* 4. Hiệu ứng khi di chuột vào (Hover) */
::-webkit-scrollbar-thumb:hover {
    background-color: #FF8F50; /* Đổi sang màu cam chính thương hiệu */
    border: 1px solid transparent; /* Làm thanh trượt to ra một chút khi hover */
}

/* 5. (Tùy chọn) Ẩn nút mũi tên 2 đầu (nếu trình duyệt hiển thị) */
::-webkit-scrollbar-button {
    display: none;
}

/* --- HEADER ACTIONS (SEARCH + FAV BUTTON) --- */
.header-actions {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px; /* Khoảng cách giữa search và nút tim */
    max-width: 600px;
    margin: 28px auto 0;
    padding: 18px 10px;
}

/* Chỉnh lại thanh search để nó tự co giãn */
.search-box-wrap {
    flex-grow: 1;
    margin: 0 !important; /* Gỡ bỏ margin cũ */
}

/* Nút Yêu thích vuông bo góc */
.btn-love-mode {
    width: 54px; height: 54px;
    border-radius: 20px;
    background: white;
    border: 2px solid white;
    box-shadow: 0 10px 30px rgba(255, 143, 80, 0.1);
    color: #ff4757;
    font-size: 1.4rem;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    transition: all 0.3s;
    flex-shrink: 0;
}

.btn-love-mode:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(255, 71, 87, 0.2);
    background: #fff0f0;
}

/* Trạng thái ĐANG XEM yêu thích */
.btn-love-mode.active {
    background: linear-gradient(135deg, #ff4757, #ff6b81);
    color: white;
    box-shadow: 0 10px 25px rgba(255, 71, 87, 0.4);
    animation: pulseRed 2s infinite; /* Hiệu ứng tim đập */
}

@keyframes pulseRed {
    0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(255, 71, 87, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
}


    </style>
</head>
<body>

    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div class="mobile-header lg:hidden">
        <button onclick="toggleSidebar()" class="text-orange-500 text-2xl mr-4"><i class="fas fa-bars"></i></button>
        <div class="flex items-center gap-2">
            <img src="../LOGO.WEBP" alt="Logo" class="w-8 h-8">
            <span class="font-black text-orange-500 text-lg">HOPVAN</span>
        </div>
    </div>
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

    <div id="menu-placeholder"></div>

    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Bản Tin <span class="text-gradient">Văn Học</span></h1>
            <p class="page-subtitle">Dữ liệu Dẫn chứng, Nhận định & Văn mẫu chọn lọc</p>
            
        <div class="header-actions">
            <div class="search-box-wrap">
                <input type="text" id="search-input" class="search-inp" placeholder="Tìm kiếm bài viết, tác giả...">
                <i class="fas fa-search search-icon"></i>
            </div>

            <button onclick="toggleFavorites()" id="btn-love-mode" class="btn-love-mode" title="Xem bộ sưu tập">
                <i class="fas fa-heart"></i>
            </button>
        </div>

        <div class="nav-wrapper">
            <button class="nav-arrow nav-prev" onclick="scrollNav(-1)"><i class="fas fa-chevron-left"></i></button>
            <div class="nav-container" id="nav-scroll-container">
                <button class="nav-btn active" onclick="filterData('all', this)">Tất cả</button>
                <button class="nav-btn" onclick="filterData('dauchan', this)">Dấu chân thời đại</button>
                <button class="nav-btn" onclick="filterData('chandung', this)">Chân dung bút lực</button>
                <button class="nav-btn" onclick="filterData('diahat', this)">Địa hạt chữ nghĩa</button>
                <button class="nav-btn" onclick="filterData('maicau', this)">Mài câu sáng chữ</button>
                <button class="nav-btn" onclick="filterData('vetsang', this)">Vệt sáng ngôn từ</button>
                <button class="nav-btn" onclick="filterData('liluan', this)">Lí luận văn học</button>
                <button class="nav-btn" onclick="filterData('cuango', this)">Cửa ngõ văn chương</button>
                <button class="nav-btn" onclick="filterData('khoinguon', this)">Khơi nguồn diễn đạt</button>
            </div>
            <button class="nav-arrow nav-next" onclick="scrollNav(1)"><i class="fas fa-chevron-right"></i></button>
        </div>

        <div id="content-area">
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin text-3xl mb-3 text-orange-300"></i>
                <br>Đang tải dữ liệu...
            </div>
        </div>

    </main>

    <script type="module" src="gam.js"></script>    
    <script src="../chatbot.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Import Menu (Đã thêm lại)
        import { initMenu } from "./menu.js";

        const firebaseConfig = { apiKey: "AIzaSyAJ9C2biYeiLPmhakzLZ4mEqfO9_VgPSZE", authDomain: "hopvan-9a648.firebaseapp.com", projectId: "hopvan-9a648", storageBucket: "hopvan-9a648.appspot.com", messagingSenderId: "429347196227", appId: "1:429347196227:web:917b8d019f0efd0f7833f6", measurementId: "G-1BG8PSRG0R" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

// ------------------------------------------------------------------
    //  LOGIC DANH SÁCH YÊU THÍCH (Dán vào trong script type="module")
    // ------------------------------------------------------------------
    
    // 1. Import thêm hàm đọc document (nếu trên đầu file chưa có)
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    let isFavMode = false; // Biến theo dõi trạng thái (Đang xem / Không xem)

    window.toggleFavorites = async () => {
        const btn = document.getElementById('btn-love-mode');
        const container = document.getElementById('content-area');
        const navBtns = document.querySelectorAll('.nav-btn'); // Các nút danh mục

        // TRƯỜNG HỢP 1: ĐANG BẬT -> TẮT (Quay về xem tất cả)
        if (isFavMode) {
            isFavMode = false;
            btn.classList.remove('active');
            btn.innerHTML = '<i class="fas fa-heart"></i>'; // Trả lại icon tim
            
            // Kích hoạt lại nút "Tất cả" và tải lại danh sách gốc
            const btnAll = document.querySelector('.nav-btn:first-child');
            if(btnAll) btnAll.click(); 
            return;
        }

        // TRƯỜNG HỢP 2: ĐANG TẮT -> BẬT (Xem danh sách yêu thích)
        isFavMode = true;
        
        // Cập nhật giao diện nút
        btn.classList.add('active');
        btn.innerHTML = '<i class="fas fa-times"></i>'; // Đổi thành dấu X để đóng
        
        // Tắt active của các nút danh mục kia cho đỡ rối
        navBtns.forEach(b => b.classList.remove('active')); 

        // Hiển thị loading đẹp
        container.innerHTML = `
            <div class="loading-state" style="padding: 60px 0;">
                <i class="fas fa-spinner fa-spin text-3xl mb-3 text-orange-300"></i>
                <br>Đang tìm trong bộ sưu tập của bạn...
            </div>`;

        try {
            const user = auth.currentUser;
            if (!user) {
                alert("Vui lòng đăng nhập để xem bộ sưu tập!");
                btn.click(); // Tự động tắt chế độ này
                return;
            }

            // Gọi lên Firebase lấy danh sách ID đã lưu
            const favSnap = await getDoc(doc(db, "favorites", user.uid));
            
            // Nếu chưa lưu bài nào
            if (!favSnap.exists() || !favSnap.data().list || favSnap.data().list.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-10">
                        <i class="far fa-folder-open text-6xl text-gray-200 mb-4"></i>
                        <h3 class="text-xl font-bold text-gray-400">Chưa có bài viết nào</h3>
                        <p class="text-sm text-gray-400 mt-2">Hãy thả tim <i class="fas fa-heart text-red-400"></i> các bài viết hay để lưu vào đây nhé!</p>
                        <button onclick="toggleFavorites()" class="mt-6 px-6 py-2 bg-orange-100 text-orange-500 rounded-full font-bold hover:bg-orange-200 transition">Quay lại Đọc báo</button>
                    </div>`;
                return;
            }

            const favIds = favSnap.data().list; // Mảng chứa các ID [id1, id2...]

            // Lọc ra các bài viết trùng khớp từ danh sách allArticles đã tải sẵn
            // (Cách này nhanh hơn là query lại database)
            const favArticles = allArticles.filter(item => favIds.includes(item.id));

            if (favArticles.length === 0) {
                container.innerHTML = '<div class="loading-state">Các bài viết bạn lưu có thể đã bị xóa khỏi hệ thống.</div>';
            } else {
                // Hiển thị danh sách kèm tiêu đề
                renderLayout(favArticles);
                
                // Chèn thêm header nhỏ báo số lượng
                container.insertAdjacentHTML('afterbegin', `
                    <div class="col-span-full mb-6 pb-4 border-b border-gray-100 flex items-center gap-3 animate-fade-in">
                        <div class="w-8 h-8 rounded-full bg-red-100 text-red-500 flex items-center justify-center font-bold"><i class="fas fa-heart"></i></div>
                        <span class="font-bold text-gray-600">Bạn đã lưu ${favArticles.length} bài viết</span>
                    </div>
                `);
            }

        } catch (e) {
            console.error(e);
            container.innerHTML = '<div class="loading-state text-red-400">Lỗi tải dữ liệu yêu thích.</div>';
        }
    };

        // Khởi tạo Menu bên trái
        initMenu(app);

        let allArticles = [];
        let currentFilter = 'all';

        // 8 Danh mục mới (để hiển thị badge)
        const CAT_CONFIG = {
            'dauchan':  { name: 'Dấu chân thời đại' },
            'chandung': { name: 'Chân dung bút lực' },
            'diahat':   { name: 'Địa hạt chữ nghĩa' },
            'maicau':   { name: 'Mài câu sáng chữ' },
            'vetsang':  { name: 'Vệt sáng ngôn từ' },
            'liluan':   { name: 'Lí luận văn học' },
            'cuango':   { name: 'Cửa ngõ văn chương' },
            'khoinguon': { name: 'Khơi nguồn diễn đạt' }
        };

        const getCatInfo = (code) => CAT_CONFIG[code] || { name: 'Bài viết' };

        // --- FETCH DATA ---
        async function loadData() {
            try {
                const q = query(collection(db, "literary_news"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);
                
                allArticles = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    allArticles.push({
                        id: doc.id,
                        slug: data.slug || null, // <--- THÊM DÒNG NÀY (Lấy slug)
                        title: data.title || "Chưa có tiêu đề",
                        category: data.type || "diahat", 
                        summary: data.summary || data.intro?.replace(/<[^>]*>?/gm, '').slice(0, 150) + "..." || "",
                        img: data.img || "../panel.webp", 
                        date: data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleDateString('vi-VN') : 'Mới cập nhật'
                    });
                });

                renderLayout(allArticles);
            } catch (e) {
                console.error(e);
                document.getElementById('content-area').innerHTML = `<div class="loading-state text-red-400">Không thể kết nối máy chủ.</div>`;
            }
        }

        // --- RENDER CARD GIAO DIỆN MỚI ---
        function renderLayout(articles) {
            const container = document.getElementById('content-area');
            container.innerHTML = '';

            if (articles.length === 0) {
                container.innerHTML = '<div class="loading-state">Chưa có bài viết nào.</div>';
                return;
            }

            let featured = null;
            let list = [...articles];

            // Nếu đang xem "Tất cả", tách bài mới nhất làm Featured
            if (currentFilter === 'all' && list.length > 0) {
                featured = list.shift(); 
            }

            let html = '';

            // Featured Card (Bài nổi bật to đùng)
            if (featured) {
                const cat = getCatInfo(featured.category);
               html += `
                <div class="featured-card card" onclick="goToDetail('${featured.slug || featured.id}', '${featured.slug ? 'slug' : 'id'}')">
                    <div class="c-img-box f-img-wrap">
                        <img src="${featured.img}" class="c-img f-img" loading="lazy">
                        <div class="c-badge" style="background:var(--primary); color:white; border:none;">MỚI NHẤT</div>
                    </div>
                    <div class="c-body f-content">
                        <div class="c-badge" style="position:static; width:fit-content; margin-bottom:10px; background:rgba(255,143,80,0.1); color:#FF8F50;">${cat.name}</div>
                        <h2 class="c-title f-title" style="font-size:2rem;">${featured.title}</h2>
                        <p class="c-desc f-desc">${featured.summary}</p>
                        <div class="c-footer">
                            <span>${featured.date}</span>
                            <span class="read-link">Đọc ngay <i class="fas fa-arrow-right"></i></span>
                        </div>
                    </div>
                </div>`;
            }

            // Grid Cards (Các bài còn lại)
            html += '<div class="news-grid">';
            list.forEach(item => {
                const cat = getCatInfo(item.category);
                html += `
                <div class="card" onclick="goToDetail('${item.slug || item.id}', '${item.slug ? 'slug' : 'id'}')">
                    <div class="c-img-box">
                        <img src="${item.img}" class="c-img" loading="lazy">
                        <div class="c-badge">${cat.name}</div>
                    </div>
                    <div class="c-body">
                        <h3 class="c-title">${item.title}</h3>
                        <p class="c-desc">${item.summary}</p>
                        <div class="c-footer">
                            <span>${item.date}</span>
                            <span class="read-link">Xem <i class="fas fa-chevron-right"></i></span>
                        </div>
                    </div>
                </div>`;
            });
            html += '</div>';

            container.innerHTML = html;
        }

        // --- FILTER LOGIC ---
        window.filterData = (cat, el) => {
            currentFilter = cat;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(el) {
                el.classList.add('active');
                el.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
            const filtered = cat === 'all' ? allArticles : allArticles.filter(i => i.category === cat);
            renderLayout(filtered);
        };

        // --- SEARCH ---
        document.getElementById('search-input').addEventListener('input', (e) => {
            const key = e.target.value.toLowerCase();
            const filtered = allArticles.filter(i => i.title.toLowerCase().includes(key));
            renderLayout(filtered);
        });

        window.scrollNav = (direction) => {
            const container = document.getElementById('nav-scroll-container');
            container.scrollBy({ left: 300 * direction, behavior: 'smooth' });
        };

        window.goToDetail = (val, type) => {
            if (type === 'slug') {
                window.location.href = `../bantinvanhoc/view.html?slug=${val}`;
            } else {
                window.location.href = `../bantinvanhoc/view.html?id=${val}`;
            }
        };

        window.toggleSidebar = () => {
            const sidebar = document.querySelector('aside');
            const overlay = document.getElementById('sidebar-overlay');
            if(sidebar) {
                sidebar.classList.toggle('open');
                if(overlay) overlay.classList.toggle('active');
            }
        };

        onAuthStateChanged(auth, (u) => { 
            if(!u) window.location.href="../log.html"; 
            else loadData(); 
        });
        
        window.addEventListener('trigger-firebase-signout', async () => { await signOut(auth); window.location.href = "../index.html"; });

    </script>
</body>
</html>